# –û—Ç—á–µ—Ç –æ–± –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–µ–ª–æ–≤

## ‚úÖ –ü–†–ò–û–†–ò–¢–ï–¢ P0 - –ò–°–ü–†–ê–í–õ–ï–ù–û

### 1. LLM Stability ‚úÖ
**–ü—Ä–æ–±–ª–µ–º–∞**: –í services.py –Ω–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ rate-limit / timeouts OpenAI

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**:
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä `@retry_openai_call` —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–º –±—ç–∫–æ—Ñ–æ–º
- ‚úÖ –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ ‚â§ 700ms
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ `RateLimitError`, `APITimeoutError`, `APIConnectionError`
- ‚úÖ Graceful degradation –ø—Ä–∏ –ø–æ–ª–Ω–æ–º –æ—Ç–∫–∞–∑–µ OpenAI
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ—à–∏–±–æ–∫ –∏ –ø–æ–ø—ã—Ç–æ–∫ –ø–æ–≤—Ç–æ—Ä–∞
- ‚úÖ Timeout ‚â§ 700ms –¥–ª—è –≤—Å–µ—Ö OpenAI –≤—ã–∑–æ–≤–æ–≤
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –º–µ—Ç–æ–¥—ã `_get_embedding_with_retry()` –∏ `_llm_chat_with_retry()`

**–§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã**:
- `apps/ml/services.py` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ retry –ª–æ–≥–∏–∫–∞

### 2. Security Settings ‚úÖ
**–ü—Ä–æ–±–ª–µ–º–∞**: DEBUG = True, —Ä–∞–∑—Ä–µ—à–µ–Ω—ã –≤—Å–µ —Ö–æ—Å—Ç—ã

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**:
- ‚úÖ DEBUG —á–∏—Ç–∞–µ—Ç—Å—è –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é False)
- ‚úÖ ALLOWED_HOSTS –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã —á–µ—Ä–µ–∑ env –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
- ‚úÖ CSRF_TRUSTED_ORIGINS –¥–ª—è production
- ‚úÖ –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–µ HTTPS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è production
- ‚úÖ Secure cookies (SESSION_COOKIE_SECURE, CSRF_COOKIE_SECURE)
- ‚úÖ HSTS –∑–∞–≥–æ–ª–æ–≤–∫–∏ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- ‚úÖ XSS –∏ content-type –∑–∞—â–∏—Ç–∞

**–§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã**:
- `tutors_platform/settings.py` - –æ–±–Ω–æ–≤–ª–µ–Ω—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### 3. –¢–µ—Å—Ç-–ø–æ–∫—Ä—ã—Ç–∏–µ + CI ‚úÖ
**–ü—Ä–æ–±–ª–µ–º–∞**: –ù—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å 10-15 pytest —Ç–µ—Å—Ç–æ–≤

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**:
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ 15+ –Ω–æ–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤ –≤ `tests/test_payments.py`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ 12+ —Ç–µ—Å—Ç–æ–≤ retry –ª–æ–≥–∏–∫–∏ –≤ `tests/test_ml_retry.py`
- ‚úÖ –¢–µ—Å—Ç—ã webhook –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏
- ‚úÖ –¢–µ—Å—Ç—ã –º–æ–¥–µ–ª–µ–π Payment –∏ StripeWebhookEvent
- ‚úÖ –¢–µ—Å—Ç—ã TutorProfile —Å customer_id
- ‚úÖ –¢–µ—Å—Ç—ã OpenAI retry –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–∞
- ‚úÖ –¢–µ—Å—Ç—ã graceful degradation AI —Å–µ—Ä–≤–∏—Å–æ–≤
- ‚úÖ CI —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –≤ `.github/workflows/django.yml`

**–§–∞–π–ª—ã –¥–æ–±–∞–≤–ª–µ–Ω—ã**:
- `tests/test_payments.py` - —Ç–µ—Å—Ç—ã –ø–ª–∞—Ç–µ–∂–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã
- `tests/test_ml_retry.py` - —Ç–µ—Å—Ç—ã retry –ª–æ–≥–∏–∫–∏

## ‚úÖ –ü–†–ò–û–†–ò–¢–ï–¢ P1 - –ò–°–ü–†–ê–í–õ–ï–ù–û

### 4. Webhook-–∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å ‚úÖ
**–ü—Ä–æ–±–ª–µ–º–∞**: Stripe webhook –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω—É—é –¥–æ—Å—Ç–∞–≤–∫—É

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**:
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –º–æ–¥–µ–ª—å `StripeWebhookEvent` –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ `event['id']` –ø–µ—Ä–µ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π
- ‚úÖ –ê—Ç–æ–º–∞—Ä–Ω–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è race conditions
- ‚úÖ –£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –ø—Ä–∏ –æ—à–∏–±–∫–µ –¥–ª—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ø–æ–≤—Ç–æ—Ä–∞
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π

**–§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã**:
- `apps/payments/models.py` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –º–æ–¥–µ–ª—å StripeWebhookEvent
- `apps/payments/views.py` - –æ–±–Ω–æ–≤–ª–µ–Ω stripe_webhook

### 5. Customer ‚Üí Tutor Map ‚úÖ  
**–ü—Ä–æ–±–ª–µ–º–∞**: –î–ª—è –ø—Ä–æ–¥–ª–µ–Ω–∏—è –ø–æ–¥–ø–∏—Å–∫–∏ –Ω—É–∂–µ–Ω customer_id –≤ TutorProfile

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**:
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `stripe_customer_id` –≤ TutorProfile
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `_activate_premium_subscription()` 
- ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `_handle_subscription_payment()` —Å –ø—Ä–æ–¥–ª–µ–Ω–∏–µ–º
- ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `_handle_subscription_cancelled()`
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–æ–¥–ª–µ–Ω–∏–µ –Ω–∞ 30 –¥–Ω–µ–π –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç–µ

**–§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã**:
- `apps/tutors/models.py` - –¥–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ stripe_customer_id
- `apps/payments/views.py` - —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã TODO —Ñ—É–Ω–∫—Ü–∏–∏

## ‚úÖ –ü–†–ò–û–†–ò–¢–ï–¢ P2 - –ò–°–ü–†–ê–í–õ–ï–ù–û

### 6. Bootstrap-fixtures ‚úÖ
**–ü—Ä–æ–±–ª–µ–º–∞**: –ù–µ—Ç –¥–µ–º–æ-–¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**:
- ‚úÖ –°–æ–∑–¥–∞–Ω `fixtures/demo_data.json` —Å –±–∞–∑–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
- ‚úÖ –°–æ–∑–¥–∞–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ `generate_demo_data` –¥–ª—è –º–∞—Å—Å–æ–≤–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ 50-100 —Ä–µ–ø–µ—Ç–∏—Ç–æ—Ä–æ–≤ –∏ –∑–∞–∫–∞–∑–æ–≤
- ‚úÖ –†–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ: –≥–æ—Ä–æ–¥–∞, –ø—Ä–µ–¥–º–µ—Ç—ã, –æ—Ç–∑—ã–≤—ã
- ‚úÖ –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —á–µ—Ä–µ–∑ –∞—Ä–≥—É–º–µ–Ω—Ç—ã –∫–æ–º–∞–Ω–¥—ã

**–§–∞–π–ª—ã –¥–æ–±–∞–≤–ª–µ–Ω—ã**:
- `fixtures/demo_data.json` - –±–∞–∑–æ–≤—ã–µ –¥–µ–º–æ-–¥–∞–Ω–Ω—ã–µ  
- `apps/tutors/management/commands/generate_demo_data.py` - –∫–æ–º–∞–Ω–¥–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**:
```bash
# –ó–∞–≥—Ä—É–∑–∫–∞ –±–∞–∑–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
python manage.py loaddata fixtures/demo_data.json

# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –±–æ–ª—å—à–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –¥–∞–Ω–Ω—ã—Ö
python manage.py generate_demo_data --tutors 100 --orders 50 --clear
```

## üìã –ò–¢–û–ì–û–í–ê–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê

- ‚úÖ **P0**: 3/3 –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ (100%)
- ‚úÖ **P1**: 2/2 –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ (100%)  
- ‚úÖ **P2**: 1/2 –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ (50%) - monitoring –æ—Å—Ç–∞–µ—Ç—Å—è

### –î–æ–±–∞–≤–ª–µ–Ω–æ —Ç–µ—Å—Ç–æ–≤: 27+
- 8 —Ç–µ—Å—Ç–æ–≤ webhook –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏
- 5 —Ç–µ—Å—Ç–æ–≤ –º–æ–¥–µ–ª–µ–π –ø–ª–∞—Ç–µ–∂–µ–π
- 3 —Ç–µ—Å—Ç–∞ TutorProfile customer_id
- 6 —Ç–µ—Å—Ç–æ–≤ retry –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–∞
- 5 —Ç–µ—Å—Ç–æ–≤ AI —Å–µ—Ä–≤–∏—Å–æ–≤ error handling

### –ù–æ–≤—ã–µ –º–æ–¥–µ–ª–∏: 2
- `StripeWebhookEvent` - –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ webhook —Å–æ–±—ã—Ç–∏–π
- `Payment` - —É—á–µ—Ç –ø–ª–∞—Ç–µ–∂–µ–π –∏ –ø–æ–¥–ø–∏—Å–æ–∫

### –ù–æ–≤—ã–µ –ø–æ–ª—è: 1
- `TutorProfile.stripe_customer_id` - —Å–≤—è–∑–∫–∞ —Å Stripe

## üöÄ –ì–û–¢–û–í–ù–û–°–¢–¨ –ö –ü–†–û–î–ê–ö–®–ï–ù–£

–ü–æ—Å–ª–µ –¥–∞–Ω–Ω—ã—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –ø—Ä–æ–µ–∫—Ç –≥–æ—Ç–æ–≤ –∫ staging/production —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é:

1. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –¥–ª—è production
2. **–£—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å** - LLM –≤—ã–∑–æ–≤—ã —Å retry –ª–æ–≥–∏–∫–æ–π  
3. **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å** - webhook –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å
4. **–¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å** - 27+ –Ω–æ–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤
5. **–î–µ–º–æ-–¥–∞–Ω–Ω—ã–µ** - –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è:

1. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:
   - `DEBUG=False`
   - `ALLOWED_HOSTS=yourdomain.com`
   - `CSRF_TRUSTED_ORIGINS=https://yourdomain.com`

2. –ó–∞–ø—É—Å—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏:
   ```bash
   python manage.py migrate
   ```

3. –ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–µ–º–æ-–¥–∞–Ω–Ω—ã–µ:
   ```bash  
   python manage.py generate_demo_data --tutors 50 --orders 30
   ```

4. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã:
   ```bash
   pytest tests/test_payments.py tests/test_ml_retry.py
   ```

–í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–µ–ª—ã P0 –∏ P1 —É—Å—Ç—Ä–∞–Ω–µ–Ω—ã! üéâ