{% extends 'base.html' %}

{% block title %}–ü–æ–∏—Å–∫ —Ä–µ–ø–µ—Ç–∏—Ç–æ—Ä–æ–≤ - Tutors Platform{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <!-- Search Header -->
    <div class="bg-white rounded-lg shadow-md p-6 mb-8">
        <h1 class="text-3xl font-bold text-gray-900 mb-6">–ü–æ–∏—Å–∫ —Ä–µ–ø–µ—Ç–∏—Ç–æ—Ä–æ–≤</h1>
        
        <!-- Search Form -->
        <form 
            hx-get="/api/tutors/search/"
            hx-trigger="submit, change from:select, change from:input"
            hx-target="#tutors-results"
            hx-indicator="#search-loading"
            class="space-y-6"
        >
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div>
                    <label for="subject" class="block text-sm font-medium text-gray-700 mb-2">
                        –ü—Ä–µ–¥–º–µ—Ç
                    </label>
                    <select 
                        name="subject" 
                        id="subject"
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                    >
                        <option value="">–í—Å–µ –ø—Ä–µ–¥–º–µ—Ç—ã</option>
                        {% for subject in subjects %}
                            <option value="{{ subject.id }}">{{ subject.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                
                <div>
                    <label for="price_min" class="block text-sm font-medium text-gray-700 mb-2">
                        –¶–µ–Ω–∞ –æ—Ç (—Ä—É–±/—á–∞—Å)
                    </label>
                    <input 
                        type="number" 
                        name="price_min" 
                        id="price_min"
                        min="0"
                        step="100"
                        placeholder="500"
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                    />
                </div>
                
                <div>
                    <label for="price_max" class="block text-sm font-medium text-gray-700 mb-2">
                        –¶–µ–Ω–∞ –¥–æ (—Ä—É–±/—á–∞—Å)
                    </label>
                    <input 
                        type="number" 
                        name="price_max" 
                        id="price_max"
                        min="0"
                        step="100"
                        placeholder="3000"
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                    />
                </div>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div>
                    <label for="format" class="block text-sm font-medium text-gray-700 mb-2">
                        –§–æ—Ä–º–∞—Ç
                    </label>
                    <select 
                        name="format" 
                        id="format"
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                    >
                        <option value="">–õ—é–±–æ–π —Ñ–æ—Ä–º–∞—Ç</option>
                        <option value="online">–û–Ω–ª–∞–π–Ω</option>
                        <option value="offline">–û—á–Ω–æ</option>
                        <option value="both">–û–Ω–ª–∞–π–Ω –∏ –æ—á–Ω–æ</option>
                    </select>
                </div>
                
                <div>
                    <label for="experience" class="block text-sm font-medium text-gray-700 mb-2">
                        –û–ø—ã—Ç
                    </label>
                    <select 
                        name="experience" 
                        id="experience"
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                    >
                        <option value="">–õ—é–±–æ–π –æ–ø—ã—Ç</option>
                        <option value="1-3">1-3 –≥–æ–¥–∞</option>
                        <option value="3-5">3-5 –ª–µ—Ç</option>
                        <option value="5-10">5-10 –ª–µ—Ç</option>
                        <option value="10+">–ë–æ–ª–µ–µ 10 –ª–µ—Ç</option>
                    </select>
                </div>
                
                <div>
                    <label for="rating" class="block text-sm font-medium text-gray-700 mb-2">
                        –†–µ–π—Ç–∏–Ω–≥
                    </label>
                    <select 
                        name="rating" 
                        id="rating"
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                    >
                        <option value="">–õ—é–±–æ–π —Ä–µ–π—Ç–∏–Ω–≥</option>
                        <option value="4.5">4.5+ –∑–≤–µ–∑–¥</option>
                        <option value="4.0">4.0+ –∑–≤–µ–∑–¥</option>
                        <option value="3.5">3.5+ –∑–≤–µ–∑–¥</option>
                    </select>
                </div>
                
                <div>
                    <label for="sort" class="block text-sm font-medium text-gray-700 mb-2">
                        –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
                    </label>
                    <select 
                        name="sort" 
                        id="sort"
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                    >
                        <option value="rating">–ü–æ —Ä–µ–π—Ç–∏–Ω–≥—É</option>
                        <option value="price_low">–ü–æ —Ü–µ–Ω–µ (–¥–µ—à–µ–≤–ª–µ)</option>
                        <option value="price_high">–ü–æ —Ü–µ–Ω–µ (–¥–æ—Ä–æ–∂–µ)</option>
                        <option value="experience">–ü–æ –æ–ø—ã—Ç—É</option>
                    </select>
                </div>
            </div>
            
            <div class="flex justify-between items-center">
                <button 
                    type="submit"
                    class="bg-blue-600 text-white px-6 py-2 rounded-md hover:bg-blue-700 transition-colors"
                >
                    üîç –ù–∞–π—Ç–∏ —Ä–µ–ø–µ—Ç–∏—Ç–æ—Ä–æ–≤
                </button>
                
                <div id="search-loading" class="htmx-indicator">
                    <div class="flex items-center text-gray-600">
                        <div class="animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600 mr-2"></div>
                        –ü–æ–∏—Å–∫...
                    </div>
                </div>
            </div>
        </form>
    </div>
    
    <!-- Results -->
    <div id="tutors-results">
        <!-- Initial state or loading -->
        <div class="text-center py-12">
            <div class="text-gray-500 text-lg">
                –í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞, —á—Ç–æ–±—ã –Ω–∞–π—Ç–∏ —Ä–µ–ø–µ—Ç–∏—Ç–æ—Ä–æ–≤
            </div>
        </div>
    </div>
</div>

<!-- Tutor Card Template (for HTMX) -->
<template id="tutor-card-template">
    <div class="bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition-shadow">
        <div class="flex items-start space-x-4">
            <div class="flex-shrink-0">
                <div class="w-16 h-16 bg-blue-500 rounded-full flex items-center justify-center text-white font-bold text-xl">
                    {{ tutor.initials }}
                </div>
            </div>
            
            <div class="flex-1 min-w-0">
                <div class="flex items-center justify-between mb-2">
                    <h3 class="text-lg font-semibold text-gray-900">{{ tutor.full_name }}</h3>
                    <div class="flex items-center">
                        <span class="text-yellow-400 text-sm">‚≠ê</span>
                        <span class="text-sm text-gray-600 ml-1">{{ tutor.rating }}</span>
                        <span class="text-sm text-gray-500 ml-1">({{ tutor.reviews_count }} –æ—Ç–∑—ã–≤–æ–≤)</span>
                    </div>
                </div>
                
                <p class="text-sm text-gray-600 mb-2">{{ tutor.subjects }}</p>
                
                <div class="flex items-center space-x-4 text-sm text-gray-500 mb-3">
                    <span>üë®‚Äçüè´ {{ tutor.experience }} –ª–µ—Ç –æ–ø—ã—Ç–∞</span>
                    <span>üéì {{ tutor.education }}</span>
                    <span>üìç {{ tutor.location }}</span>
                </div>
                
                <p class="text-gray-700 mb-4 line-clamp-2">{{ tutor.description }}</p>
                
                <div class="flex items-center justify-between">
                    <div class="text-lg font-semibold text-blue-600">
                        {{ tutor.price }} ‚ÇΩ/—á–∞—Å
                    </div>
                    
                    <div class="flex space-x-2">
                        <button 
                            hx-get="/api/tutors/{{ tutor.id }}/profile/"
                            hx-target="#modals"
                            hx-swap="innerHTML"
                            class="text-blue-600 hover:text-blue-800 text-sm font-medium"
                        >
                            –ü–æ–¥—Ä–æ–±–Ω–µ–µ
                        </button>
                        
                        <button 
                            hx-post="/api/orders/create_from_tutor/"
                            hx-vals='{"tutor_id": "{{ tutor.id }}"}'
                            hx-target="#modals"
                            hx-swap="innerHTML"
                            class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors text-sm"
                        >
                            –ó–∞–∫–∞–∑–∞—Ç—å
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</template>

<!-- Tutor Profile Modal Template -->
<template id="tutor-profile-modal">
    <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto">
            <div class="p-6">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-2xl font-bold text-gray-900">{{ tutor.full_name }}</h2>
                    <button 
                        onclick="this.closest('.fixed').remove()"
                        class="text-gray-400 hover:text-gray-600"
                    >
                        ‚úï
                    </button>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <div class="w-24 h-24 bg-blue-500 rounded-full flex items-center justify-center text-white font-bold text-2xl mx-auto mb-4">
                            {{ tutor.initials }}
                        </div>
                        
                        <div class="text-center mb-6">
                            <div class="flex items-center justify-center mb-2">
                                <span class="text-yellow-400 text-lg">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</span>
                                <span class="text-lg font-semibold ml-2">{{ tutor.rating }}</span>
                            </div>
                            <p class="text-gray-600">{{ tutor.reviews_count }} –æ—Ç–∑—ã–≤–æ–≤</p>
                        </div>
                        
                        <div class="space-y-3">
                            <div class="flex items-center">
                                <span class="text-gray-500 w-20">–ü—Ä–µ–¥–º–µ—Ç—ã:</span>
                                <span class="font-medium">{{ tutor.subjects }}</span>
                            </div>
                            <div class="flex items-center">
                                <span class="text-gray-500 w-20">–û–ø—ã—Ç:</span>
                                <span class="font-medium">{{ tutor.experience }} –ª–µ—Ç</span>
                            </div>
                            <div class="flex items-center">
                                <span class="text-gray-500 w-20">–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ:</span>
                                <span class="font-medium">{{ tutor.education }}</span>
                            </div>
                            <div class="flex items-center">
                                <span class="text-gray-500 w-20">–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:</span>
                                <span class="font-medium">{{ tutor.location }}</span>
                            </div>
                            <div class="flex items-center">
                                <span class="text-gray-500 w-20">–¶–µ–Ω–∞:</span>
                                <span class="font-medium text-blue-600">{{ tutor.price }} ‚ÇΩ/—á–∞—Å</span>
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <h3 class="text-lg font-semibold mb-3">–û —Ä–µ–ø–µ—Ç–∏—Ç–æ—Ä–µ</h3>
                        <p class="text-gray-700 mb-6">{{ tutor.description }}</p>
                        
                        <h3 class="text-lg font-semibold mb-3">–ú–µ—Ç–æ–¥–∏–∫–∞ –æ–±—É—á–µ–Ω–∏—è</h3>
                        <p class="text-gray-700 mb-6">{{ tutor.methodology }}</p>
                        
                        <h3 class="text-lg font-semibold mb-3">–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</h3>
                        <ul class="text-gray-700 space-y-1">
                            {% for achievement in tutor.achievements %}
                                <li>‚Ä¢ {{ achievement }}</li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>
                
                <div class="mt-8 flex justify-end space-x-4">
                    <button 
                        onclick="this.closest('.fixed').remove()"
                        class="px-6 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50"
                    >
                        –ó–∞–∫—Ä—ã—Ç—å
                    </button>
                    
                    <button 
                        hx-post="/api/orders/create_from_tutor/"
                        hx-vals='{"tutor_id": "{{ tutor.id }}"}'
                        hx-target="#modals"
                        hx-swap="innerHTML"
                        class="bg-blue-600 text-white px-6 py-2 rounded-md hover:bg-blue-700"
                    >
                        –ó–∞–∫–∞–∑–∞—Ç—å –∑–∞–Ω—è—Ç–∏—è
                    </button>
                </div>
            </div>
        </div>
    </div>
</template>
{% endblock %}

{% block scripts %}
<script>
    // Auto-submit form on filter changes
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.querySelector('form');
        const inputs = form.querySelectorAll('select, input[type="number"]');
        
        inputs.forEach(input => {
            input.addEventListener('change', function() {
                // Add small delay to avoid too many requests
                clearTimeout(window.searchTimeout);
                window.searchTimeout = setTimeout(() => {
                    form.dispatchEvent(new Event('submit'));
                }, 300);
            });
        });
    });
</script>
{% endblock %}